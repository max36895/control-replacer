# Скрипт для автозамены

Скрипт предназначен для замены всех вхождений контролов, а также позволяет выполнить замену, когда контрол переносится
из одного модуля в другой

Готовый скрипт можно скачать из репозитория, либо собрать самому. Для этого нужно скачать проект, выполнить `npm i`
и `npm run build`

## Как работает

Необходимо запустить файл `dist/replacer.js`, а также создать json файл с настройкой для скрипта

### Запуск

```bash
node replacer.js config.json
```

### JSON файл настроек

#### Описание

```json
{
  "path": "Путь к репозиториям, где нужно выполнить замену",
  "replaces": [
    {
      "module": "Текущее имя модуля",
      "newModule": "Новое имя модуля. Стоит использовать когда весь модуль переносится",
      "controls": [
        {
          "name": "Текущее имя контрола",
          "newName": "Новое имя контрола",
          "newModuleName": "Новое имя модуля"
        }
      ]
    }
  ],
  "maxFileSize": "Максимальный размер файла. По умолчанию 50"
}
```

#### Примеры

Пример для замены Controls/toggle:Tumbler на Controls/toggle:NewTumbler Файл JSON

```json
{
  "path": "",
  "replaces": [
    {
      "module": "Controls/toggle",
      "controls": [
        {
          "name": "Tumbler",
          "newName": "NewTumbler"
        }
      ]
    }
  ]
}
```

Если надо заменить Controls/toggle:Tumbler на Controls/Tumbler. Обратите внимание на `newName`, если свойство не
указывать, то просто произойдет переименование модуля(`Controls/Tumbler:Tumbler`), но при указании пустой строки,
контрол подключается как модуль.

```json
{
  "path": "",
  "replaces": [
    {
      "module": "Controls/toggle",
      "controls": [
        {
          "name": "Tumbler",
          "newName": "",
          "newModuleName": "Tumbler"
        }
      ]
    }
  ]
}
 ```

#### Дополнительно

Важно чтобы в module разделение было сделано через `/` иначе возможна некорректная работа. Также в `controls` можно не
указывать newName и newModuleName, в таком случае значения поставятся из name и module. Но при этом одно из значений
должно быть заполнено, иначе скрипт посчитает что правки не нужны.

Подобное сделано для удобства, когда переименовывается только модуль или контролл.

## Что корректно работает

Скрипт автоматически вносит правки в wml файлы. А также может вносить правки в ts tsx файлах Корректно обрабатываются
следующие сценарии:

```js
import {Tumbler} from 'Controls/toggle';

<Tumbler/>
```
```js
import {Tumbler as View} from 'Controls/toggle';

<View/>
```
```js
import {default as toggle} from 'Controls/toggle';

<toggle.Tumbler/>
```
```js
import {Tumbler, Switch} from 'Controls/toggle';

<Tumbler/>
<Switch/>
```

Если из исходной библиотеки выносится 1 контрол, то скрипт сам создаст или найдет нужный импорт, и засунет туда новый контрол

## Что нестабильно работает

Сейчас есть проблемы с импортом следующего вида:
```js
import * as toggle from 'Controls/toggle';
```
Скрипт самостоятельно не сможет обработать подобные сценарии, на что кинет ошибку. Но при этом скрипт сможет внести
правки по использованию контрола, и заменит
```js
<toggle.Name>
```
на
```js
<toggle.NewName>
```
Скрипт не тронет сам импорт, так как он не знает нужно его заменить и как. Если вы полностью переносите весь модуль, то
можно указать это название в `replaces.newModule`, в таком случае скрипт заменит импорт для модуля. Свойство стоит
использовать тогда когда полностью переименовывается модуль, в противном случае скрипт отработает некорректно.

Также если контрол использовался так `Controls.LoadingIndicator`, а нужно превратить его в `Controls.loading:Indicator`,
то скрипт самостоятельно не сможет подобное обработать, а любая попытка провернуть подобное может обернуться ошибками.
Возможно, когда-то подобный функционал появится, но на данный момент в нем нет необходимости.

## Дополнительно

Через скрипт можно переименовывать различные утилиты, но есть вероятность что-то будет проблемы в редких случаях(см "Что
нестабильно работает").

Сейчас скрипт проходится чисто по всем файлам в директории, но не смотрит файлы больше 50mb, но можно настроить другое
ограничение используя `maxFileSize`(не рекомендуется устанавливать большие значения)

О найденных проблемах или идеях по улучшению можно
писать [мне](https://online.sbis.ru/person/5bf5b206-a664-422b-b5e2-41217142717a)
